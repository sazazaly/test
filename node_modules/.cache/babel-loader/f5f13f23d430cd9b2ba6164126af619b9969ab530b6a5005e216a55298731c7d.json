{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nexport class Tile2DHeader {\n  constructor(index) {\n    _defineProperty(this, \"index\", void 0);\n    _defineProperty(this, \"isVisible\", void 0);\n    _defineProperty(this, \"isSelected\", void 0);\n    _defineProperty(this, \"parent\", void 0);\n    _defineProperty(this, \"children\", void 0);\n    _defineProperty(this, \"content\", void 0);\n    _defineProperty(this, \"state\", void 0);\n    _defineProperty(this, \"layers\", void 0);\n    _defineProperty(this, \"id\", void 0);\n    _defineProperty(this, \"zoom\", void 0);\n    _defineProperty(this, \"userData\", void 0);\n    _defineProperty(this, \"boundingBox\", void 0);\n    _defineProperty(this, \"_abortController\", void 0);\n    _defineProperty(this, \"_loader\", void 0);\n    _defineProperty(this, \"_loaderId\", void 0);\n    _defineProperty(this, \"_isLoaded\", void 0);\n    _defineProperty(this, \"_isCancelled\", void 0);\n    _defineProperty(this, \"_needsReload\", void 0);\n    _defineProperty(this, \"_bbox\", void 0);\n    this.index = index;\n    this.isVisible = false;\n    this.isSelected = false;\n    this.parent = null;\n    this.children = [];\n    this.content = null;\n    this._loader = undefined;\n    this._abortController = null;\n    this._loaderId = 0;\n    this._isLoaded = false;\n    this._isCancelled = false;\n    this._needsReload = false;\n  }\n  get bbox() {\n    return this._bbox;\n  }\n  set bbox(value) {\n    if (this._bbox) return;\n    this._bbox = value;\n    if ('west' in value) {\n      this.boundingBox = [[value.west, value.south], [value.east, value.north]];\n    } else {\n      this.boundingBox = [[value.left, value.top], [value.right, value.bottom]];\n    }\n  }\n  get data() {\n    return this.isLoading && this._loader ? this._loader.then(() => this.data) : this.content;\n  }\n  get isLoaded() {\n    return this._isLoaded && !this._needsReload;\n  }\n  get isLoading() {\n    return Boolean(this._loader) && !this._isCancelled;\n  }\n  get needsReload() {\n    return this._needsReload || this._isCancelled;\n  }\n  get byteLength() {\n    const result = this.content ? this.content.byteLength : 0;\n    if (!Number.isFinite(result)) {\n      console.error('byteLength not defined in tile data');\n    }\n    return result;\n  }\n  async _loadData({\n    getData,\n    requestScheduler,\n    onLoad,\n    onError\n  }) {\n    const {\n      index,\n      id,\n      bbox,\n      userData,\n      zoom\n    } = this;\n    const loaderId = this._loaderId;\n    this._abortController = new AbortController();\n    const {\n      signal\n    } = this._abortController;\n    const requestToken = await requestScheduler.scheduleRequest(this, tile => {\n      return tile.isSelected ? 1 : -1;\n    });\n    if (!requestToken) {\n      this._isCancelled = true;\n      return;\n    }\n    if (this._isCancelled) {\n      requestToken.done();\n      return;\n    }\n    let tileData = null;\n    let error;\n    try {\n      tileData = await getData({\n        index,\n        id,\n        bbox,\n        userData,\n        zoom,\n        signal\n      });\n    } catch (err) {\n      error = err || true;\n    } finally {\n      requestToken.done();\n    }\n    if (loaderId !== this._loaderId) {\n      return;\n    }\n    this._loader = undefined;\n    this.content = tileData;\n    if (this._isCancelled && !tileData) {\n      this._isLoaded = false;\n      return;\n    }\n    this._isLoaded = true;\n    this._isCancelled = false;\n    if (error) {\n      onError(error, this);\n    } else {\n      onLoad(this);\n    }\n  }\n  loadData(opts) {\n    this._isLoaded = false;\n    this._isCancelled = false;\n    this._needsReload = false;\n    this._loaderId++;\n    this._loader = this._loadData(opts);\n    return this._loader;\n  }\n  setNeedsReload() {\n    if (this.isLoading) {\n      this.abort();\n      this._loader = undefined;\n    }\n    this._needsReload = true;\n  }\n  abort() {\n    var _this$_abortControlle;\n    if (this.isLoaded) {\n      return;\n    }\n    this._isCancelled = true;\n    (_this$_abortControlle = this._abortController) === null || _this$_abortControlle === void 0 ? void 0 : _this$_abortControlle.abort();\n  }\n}","map":{"version":3,"names":["Tile2DHeader","constructor","index","_defineProperty","isVisible","isSelected","parent","children","content","_loader","undefined","_abortController","_loaderId","_isLoaded","_isCancelled","_needsReload","bbox","_bbox","value","boundingBox","west","south","east","north","left","top","right","bottom","data","isLoading","then","isLoaded","Boolean","needsReload","byteLength","result","Number","isFinite","console","error","_loadData","getData","requestScheduler","onLoad","onError","id","userData","zoom","loaderId","AbortController","signal","requestToken","scheduleRequest","tile","done","tileData","err","loadData","opts","setNeedsReload","abort","_this$_abortControlle"],"sources":["C:\\Users\\GC\\Downloads\\dispatch_vehicles\\dispatch_vehicles\\simulation_vis\\node_modules\\@deck.gl\\geo-layers\\src\\tileset-2d\\tile-2d-header.ts"],"sourcesContent":["/* eslint-env browser */\nimport {RequestScheduler} from '@loaders.gl/loader-utils';\nimport {TileBoundingBox, TileIndex, TileLoadProps} from './types';\nimport type {Layer} from '@deck.gl/core';\n\nexport type TileLoadDataProps<DataT = any> = {\n  requestScheduler: RequestScheduler;\n  getData: (props: TileLoadProps) => Promise<DataT>;\n  onLoad: (tile: Tile2DHeader<DataT>) => void;\n  onError: (error: any, tile: Tile2DHeader<DataT>) => void;\n};\n\nexport class Tile2DHeader<DataT = any> {\n  index: TileIndex;\n  isVisible: boolean;\n  isSelected: boolean;\n  parent: Tile2DHeader | null;\n  children: Tile2DHeader[] | null;\n  content: DataT | null;\n  state?: number;\n  layers?: Layer[] | null;\n\n  id!: string; // assigned _always_ with result of `getTileId`\n  zoom!: number; // assigned _always_ with result of `getTileZoom`\n  userData?: Record<string, any>; // _may be_ assigned with result of `getTileMetadata`\n  boundingBox!: [min: number[], max: number[]]; // assigned _always_ with bbox from `getTileMetadata`\n\n  private _abortController: AbortController | null;\n  private _loader: Promise<void> | undefined;\n  private _loaderId: number;\n  private _isLoaded: boolean;\n  private _isCancelled: boolean;\n  private _needsReload: boolean;\n  private _bbox!: TileBoundingBox;\n\n  constructor(index: TileIndex) {\n    this.index = index;\n    this.isVisible = false;\n    this.isSelected = false;\n    this.parent = null;\n    this.children = [];\n\n    this.content = null;\n\n    this._loader = undefined;\n    this._abortController = null;\n    this._loaderId = 0;\n    this._isLoaded = false;\n    this._isCancelled = false;\n    this._needsReload = false;\n  }\n\n  /** @deprecated use `boundingBox` instead */\n  get bbox(): TileBoundingBox {\n    return this._bbox;\n  }\n\n  // TODO - remove in v9\n  set bbox(value: TileBoundingBox) {\n    // Only set once from `Tileset2D.getTileMetadata`\n    if (this._bbox) return;\n\n    this._bbox = value;\n    if ('west' in value) {\n      this.boundingBox = [\n        [value.west, value.south],\n        [value.east, value.north]\n      ];\n    } else {\n      this.boundingBox = [\n        [value.left, value.top],\n        [value.right, value.bottom]\n      ];\n    }\n  }\n\n  get data(): Promise<DataT | null> | DataT | null {\n    return this.isLoading && this._loader ? this._loader.then(() => this.data) : this.content;\n  }\n\n  get isLoaded(): boolean {\n    return this._isLoaded && !this._needsReload;\n  }\n\n  get isLoading(): boolean {\n    return Boolean(this._loader) && !this._isCancelled;\n  }\n\n  get needsReload(): boolean {\n    return this._needsReload || this._isCancelled;\n  }\n\n  get byteLength(): number {\n    const result = this.content ? (this.content as any).byteLength : 0;\n    if (!Number.isFinite(result)) {\n      // eslint-disable-next-line no-console\n      console.error('byteLength not defined in tile data');\n    }\n    return result;\n  }\n\n  /* eslint-disable max-statements */\n  private async _loadData({\n    getData,\n    requestScheduler,\n    onLoad,\n    onError\n  }: TileLoadDataProps<DataT>): Promise<void> {\n    const {index, id, bbox, userData, zoom} = this;\n    const loaderId = this._loaderId;\n\n    this._abortController = new AbortController();\n    const {signal} = this._abortController;\n\n    // @ts-expect-error (2345) Argument of type '(tile: any) => 1 | -1' is not assignable ...\n    const requestToken = await requestScheduler.scheduleRequest(this, tile => {\n      return tile.isSelected ? 1 : -1;\n    });\n\n    if (!requestToken) {\n      this._isCancelled = true;\n      return;\n    }\n    // A tile can be cancelled while being scheduled\n    if (this._isCancelled) {\n      requestToken.done();\n      return;\n    }\n\n    let tileData: DataT | null = null;\n    let error;\n    try {\n      tileData = await getData({index, id, bbox, userData, zoom, signal});\n    } catch (err) {\n      error = err || true;\n    } finally {\n      requestToken.done();\n    }\n\n    // If loadData has been called with a newer version, discard the result from this operation\n    if (loaderId !== this._loaderId) {\n      return;\n    }\n    // Clear the `isLoading` flag\n    this._loader = undefined;\n    // Rewrite tile content with the result of getTileData if successful, or `null` in case of\n    // error or cancellation\n    this.content = tileData;\n    // If cancelled, do not invoke the callbacks\n    // Consider it loaded if we tried to cancel but `getTileData` still returned data\n    if (this._isCancelled && !tileData) {\n      this._isLoaded = false;\n      return;\n    }\n    this._isLoaded = true;\n    this._isCancelled = false;\n\n    if (error) {\n      onError(error, this);\n    } else {\n      onLoad(this);\n    }\n  }\n\n  loadData(opts: TileLoadDataProps): Promise<void> {\n    this._isLoaded = false;\n    this._isCancelled = false;\n    this._needsReload = false;\n    this._loaderId++;\n    this._loader = this._loadData(opts);\n    return this._loader;\n  }\n\n  setNeedsReload(): void {\n    if (this.isLoading) {\n      this.abort();\n      this._loader = undefined;\n    }\n    this._needsReload = true;\n  }\n\n  abort(): void {\n    if (this.isLoaded) {\n      return;\n    }\n\n    this._isCancelled = true;\n    this._abortController?.abort();\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}