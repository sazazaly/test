{"ast":null,"code":"import { isWebGL2 } from '@luma.gl/gltools';\nimport { log } from '@luma.gl/webgl';\nimport { pbr } from '@luma.gl/shadertools';\nimport ModelNode from '../scenegraph/model-node';\nimport GLTFMaterialParser from './gltf-material-parser';\nconst vs = \"\\n#if (__VERSION__ < 300)\\n  #define _attr attribute\\n#else\\n  #define _attr in\\n#endif\\n\\n  _attr vec4 POSITION;\\n\\n  #ifdef HAS_NORMALS\\n    _attr vec4 NORMAL;\\n  #endif\\n\\n  #ifdef HAS_TANGENTS\\n    _attr vec4 TANGENT;\\n  #endif\\n\\n  #ifdef HAS_UV\\n    _attr vec2 TEXCOORD_0;\\n  #endif\\n\\n  void main(void) {\\n    vec4 _NORMAL = vec4(0.);\\n    vec4 _TANGENT = vec4(0.);\\n    vec2 _TEXCOORD_0 = vec2(0.);\\n\\n    #ifdef HAS_NORMALS\\n      _NORMAL = NORMAL;\\n    #endif\\n\\n    #ifdef HAS_TANGENTS\\n      _TANGENT = TANGENT;\\n    #endif\\n\\n    #ifdef HAS_UV\\n      _TEXCOORD_0 = TEXCOORD_0;\\n    #endif\\n\\n    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);\\n    gl_Position = u_MVPMatrix * POSITION;\\n  }\\n\";\nconst fs = \"\\n#if (__VERSION__ < 300)\\n  #define fragmentColor gl_FragColor\\n#else\\n  out vec4 fragmentColor;\\n#endif\\n\\n  void main(void) {\\n    fragmentColor = pbr_filterColor(vec4(0));\\n  }\\n\";\nfunction addVersionToShader(gl, source) {\n  if (isWebGL2(gl)) {\n    return \"#version 300 es\\n\".concat(source);\n  }\n  return source;\n}\nexport default function createGLTFModel(gl, options) {\n  const {\n    id,\n    drawMode,\n    vertexCount,\n    attributes,\n    modelOptions\n  } = options;\n  const materialParser = new GLTFMaterialParser(gl, options);\n  log.info(4, 'createGLTFModel defines: ', materialParser.defines)();\n  const managedResources = [];\n  managedResources.push(...materialParser.generatedTextures);\n  managedResources.push(...Object.values(attributes).map(attribute => attribute.buffer));\n  const model = new ModelNode(gl, {\n    id,\n    drawMode,\n    vertexCount,\n    modules: [pbr],\n    parameters: materialParser.parameters,\n    vs: addVersionToShader(gl, vs),\n    fs: addVersionToShader(gl, fs),\n    managedResources,\n    ...modelOptions,\n    defines: {\n      ...materialParser.defines,\n      ...modelOptions.defines\n    }\n  });\n  model.setProps({\n    attributes\n  });\n  model.setUniforms(materialParser.uniforms);\n  return model;\n}","map":{"version":3,"names":["isWebGL2","log","pbr","ModelNode","GLTFMaterialParser","vs","fs","addVersionToShader","gl","source","concat","createGLTFModel","options","id","drawMode","vertexCount","attributes","modelOptions","materialParser","info","defines","managedResources","push","generatedTextures","Object","values","map","attribute","buffer","model","modules","parameters","setProps","setUniforms","uniforms"],"sources":["C:\\Users\\GC\\Downloads\\dispatch_vehicles\\dispatch_vehicles\\simulation_vis\\node_modules\\@luma.gl\\experimental\\src\\gltf\\create-gltf-model.js"],"sourcesContent":["import {isWebGL2} from '@luma.gl/gltools';\nimport {log} from '@luma.gl/webgl';\nimport {pbr} from '@luma.gl/shadertools';\nimport ModelNode from '../scenegraph/model-node';\nimport GLTFMaterialParser from './gltf-material-parser';\n\nconst vs = `\n#if (__VERSION__ < 300)\n  #define _attr attribute\n#else\n  #define _attr in\n#endif\n\n  _attr vec4 POSITION;\n\n  #ifdef HAS_NORMALS\n    _attr vec4 NORMAL;\n  #endif\n\n  #ifdef HAS_TANGENTS\n    _attr vec4 TANGENT;\n  #endif\n\n  #ifdef HAS_UV\n    _attr vec2 TEXCOORD_0;\n  #endif\n\n  void main(void) {\n    vec4 _NORMAL = vec4(0.);\n    vec4 _TANGENT = vec4(0.);\n    vec2 _TEXCOORD_0 = vec2(0.);\n\n    #ifdef HAS_NORMALS\n      _NORMAL = NORMAL;\n    #endif\n\n    #ifdef HAS_TANGENTS\n      _TANGENT = TANGENT;\n    #endif\n\n    #ifdef HAS_UV\n      _TEXCOORD_0 = TEXCOORD_0;\n    #endif\n\n    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);\n    gl_Position = u_MVPMatrix * POSITION;\n  }\n`;\n\nconst fs = `\n#if (__VERSION__ < 300)\n  #define fragmentColor gl_FragColor\n#else\n  out vec4 fragmentColor;\n#endif\n\n  void main(void) {\n    fragmentColor = pbr_filterColor(vec4(0));\n  }\n`;\n\nfunction addVersionToShader(gl, source) {\n  if (isWebGL2(gl)) {\n    return `#version 300 es\\n${source}`;\n  }\n\n  return source;\n}\n\nexport default function createGLTFModel(gl, options) {\n  const {id, drawMode, vertexCount, attributes, modelOptions} = options;\n  const materialParser = new GLTFMaterialParser(gl, options);\n\n  log.info(4, 'createGLTFModel defines: ', materialParser.defines)();\n\n  // Calculate managedResources\n  // TODO: Implement resource management logic that will\n  // not deallocate resources/textures/buffers that are shared\n  const managedResources = [];\n  managedResources.push(...materialParser.generatedTextures);\n  managedResources.push(...Object.values(attributes).map(attribute => attribute.buffer));\n\n  const model = new ModelNode(gl, {\n    id,\n    drawMode,\n    vertexCount,\n    modules: [pbr],\n    parameters: materialParser.parameters,\n    vs: addVersionToShader(gl, vs),\n    fs: addVersionToShader(gl, fs),\n    managedResources,\n    ...modelOptions,\n    defines: {...materialParser.defines, ...modelOptions.defines}\n  });\n\n  model.setProps({attributes});\n  model.setUniforms(materialParser.uniforms);\n\n  return model;\n}\n"],"mappings":"AAAA,SAAQA,QAAR,QAAuB,kBAAvB;AACA,SAAQC,GAAR,QAAkB,gBAAlB;AACA,SAAQC,GAAR,QAAkB,sBAAlB;AACA,OAAOC,SAAP,MAAsB,0BAAtB;AACA,OAAOC,kBAAP,MAA+B,wBAA/B;AAEA,MAAMC,EAAE,iuBAAR;AA2CA,MAAMC,EAAE,2LAAR;AAYA,SAASC,kBAATA,CAA4BC,EAA5B,EAAgCC,MAAhC,EAAwC;EACtC,IAAIT,QAAQ,CAACQ,EAAD,CAAZ,EAAkB;IAChB,2BAAAE,MAAA,CAA2BD,MAA3B;EACD;EAED,OAAOA,MAAP;AACD;AAED,eAAe,SAASE,eAATA,CAAyBH,EAAzB,EAA6BI,OAA7B,EAAsC;EACnD,MAAM;IAACC,EAAD;IAAKC,QAAL;IAAeC,WAAf;IAA4BC,UAA5B;IAAwCC;EAAxC,IAAwDL,OAA9D;EACA,MAAMM,cAAc,GAAG,IAAId,kBAAJ,CAAuBI,EAAvB,EAA2BI,OAA3B,CAAvB;EAEAX,GAAG,CAACkB,IAAJ,CAAS,CAAT,EAAY,2BAAZ,EAAyCD,cAAc,CAACE,OAAxD;EAKA,MAAMC,gBAAgB,GAAG,EAAzB;EACAA,gBAAgB,CAACC,IAAjB,CAAsB,GAAGJ,cAAc,CAACK,iBAAxC;EACAF,gBAAgB,CAACC,IAAjB,CAAsB,GAAGE,MAAM,CAACC,MAAP,CAAcT,UAAd,EAA0BU,GAA1B,CAA8BC,SAAS,IAAIA,SAAS,CAACC,MAArD,CAAzB;EAEA,MAAMC,KAAK,GAAG,IAAI1B,SAAJ,CAAcK,EAAd,EAAkB;IAC9BK,EAD8B;IAE9BC,QAF8B;IAG9BC,WAH8B;IAI9Be,OAAO,EAAE,CAAC5B,GAAD,CAJqB;IAK9B6B,UAAU,EAAEb,cAAc,CAACa,UALG;IAM9B1B,EAAE,EAAEE,kBAAkB,CAACC,EAAD,EAAKH,EAAL,CANQ;IAO9BC,EAAE,EAAEC,kBAAkB,CAACC,EAAD,EAAKF,EAAL,CAPQ;IAQ9Be,gBAR8B;IAS9B,GAAGJ,YAT2B;IAU9BG,OAAO,EAAE;MAAC,GAAGF,cAAc,CAACE,OAAnB;MAA4B,GAAGH,YAAY,CAACG;IAA5C;EAVqB,CAAlB,CAAd;EAaAS,KAAK,CAACG,QAAN,CAAe;IAAChB;EAAD,CAAf;EACAa,KAAK,CAACI,WAAN,CAAkBf,cAAc,CAACgB,QAAjC;EAEA,OAAOL,KAAP;AACD","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}