{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { Framebuffer, Texture2D, withParameters } from '@luma.gl/core';\nimport { _LayersPass as LayersPass } from '@deck.gl/core';\nexport default class MaskPass extends LayersPass {\n  constructor(gl, props) {\n    super(gl, props);\n    _defineProperty(this, \"maskMap\", void 0);\n    _defineProperty(this, \"fbo\", void 0);\n    const {\n      mapSize = 2048\n    } = props;\n    this.maskMap = new Texture2D(gl, {\n      width: mapSize,\n      height: mapSize,\n      parameters: {\n        [10241]: 9729,\n        [10240]: 9729,\n        [10242]: 33071,\n        [10243]: 33071\n      }\n    });\n    this.fbo = new Framebuffer(gl, {\n      id: 'maskmap',\n      width: mapSize,\n      height: mapSize,\n      attachments: {\n        [36064]: this.maskMap\n      }\n    });\n  }\n  render(options) {\n    const gl = this.gl;\n    const colorMask = [false, false, false, false];\n    colorMask[options.channel] = true;\n    return withParameters(gl, {\n      clearColor: [255, 255, 255, 255],\n      blend: true,\n      blendFunc: [0, 1],\n      blendEquation: 32778,\n      colorMask,\n      depthTest: false\n    }, () => super.render({\n      ...options,\n      target: this.fbo,\n      pass: 'mask'\n    }));\n  }\n  shouldDrawLayer(layer) {\n    return layer.props.operation.includes('mask');\n  }\n  delete() {\n    this.fbo.delete();\n    this.maskMap.delete();\n  }\n}","map":{"version":3,"names":["Framebuffer","Texture2D","withParameters","_LayersPass","LayersPass","MaskPass","constructor","gl","props","_defineProperty","mapSize","maskMap","width","height","parameters","fbo","id","attachments","render","options","colorMask","channel","clearColor","blend","blendFunc","blendEquation","depthTest","target","pass","shouldDrawLayer","layer","operation","includes","delete"],"sources":["/Users/jae/Downloads/dispatch_vehicles/dispatch_vehicles/simulation_vis/node_modules/@deck.gl/extensions/src/mask/mask-pass.ts"],"sourcesContent":["import {Framebuffer, Texture2D, withParameters} from '@luma.gl/core';\nimport {_LayersPass as LayersPass, LayersPassRenderOptions} from '@deck.gl/core';\n\ntype MaskPassRenderOptions = LayersPassRenderOptions & {\n  /** The channel to render into, 0:red, 1:green, 2:blue, 3:alpha */\n  channel: number;\n};\n\nexport default class MaskPass extends LayersPass {\n  maskMap: Texture2D;\n  fbo: Framebuffer;\n\n  constructor(gl, props: {id: string; mapSize?: number}) {\n    super(gl, props);\n\n    const {mapSize = 2048} = props;\n\n    this.maskMap = new Texture2D(gl, {\n      width: mapSize,\n      height: mapSize,\n      parameters: {\n        [gl.TEXTURE_MIN_FILTER]: gl.LINEAR,\n        [gl.TEXTURE_MAG_FILTER]: gl.LINEAR,\n        [gl.TEXTURE_WRAP_S]: gl.CLAMP_TO_EDGE,\n        [gl.TEXTURE_WRAP_T]: gl.CLAMP_TO_EDGE\n      }\n    });\n\n    this.fbo = new Framebuffer(gl, {\n      id: 'maskmap',\n      width: mapSize,\n      height: mapSize,\n      attachments: {\n        [gl.COLOR_ATTACHMENT0]: this.maskMap\n      }\n    });\n  }\n\n  render(options: MaskPassRenderOptions) {\n    const gl = this.gl;\n\n    const colorMask = [false, false, false, false];\n    colorMask[options.channel] = true;\n\n    return withParameters(\n      gl,\n      {\n        clearColor: [255, 255, 255, 255],\n        blend: true,\n        blendFunc: [gl.ZERO, gl.ONE],\n        blendEquation: gl.FUNC_SUBTRACT,\n        colorMask,\n        depthTest: false\n      },\n      () => super.render({...options, target: this.fbo, pass: 'mask'})\n    );\n  }\n\n  shouldDrawLayer(layer) {\n    return layer.props.operation.includes('mask');\n  }\n\n  delete() {\n    this.fbo.delete();\n    this.maskMap.delete();\n  }\n}\n"],"mappings":";AAAA,SAAQA,WAAR,EAAqBC,SAArB,EAAgCC,cAAhC,QAAqD,eAArD;AACA,SAAQC,WAAW,IAAIC,UAAvB,QAAiE,eAAjE;AAOA,eAAe,MAAMC,QAAN,SAAuBD,UAAvB,CAAkC;EAI/CE,WAAWA,CAACC,EAAD,EAAKC,KAAL,EAA4C;IACrD,MAAMD,EAAN,EAAUC,KAAV;IADqDC,eAAA;IAAAA,eAAA;IAGrD,MAAM;MAACC,OAAO,GAAG;IAAX,IAAmBF,KAAzB;IAEA,KAAKG,OAAL,GAAe,IAAIV,SAAJ,CAAcM,EAAd,EAAkB;MAC/BK,KAAK,EAAEF,OADwB;MAE/BG,MAAM,EAAEH,OAFuB;MAG/BI,UAAU,EAAE;QACV,aADU;QAEV,aAFU;QAGV,cAHU;QAIV;MAJU;IAHmB,CAAlB,CAAf;IAWA,KAAKC,GAAL,GAAW,IAAIf,WAAJ,CAAgBO,EAAhB,EAAoB;MAC7BS,EAAE,EAAE,SADyB;MAE7BJ,KAAK,EAAEF,OAFsB;MAG7BG,MAAM,EAAEH,OAHqB;MAI7BO,WAAW,EAAE;QACX,SAAwB,KAAKN;MADlB;IAJgB,CAApB,CAAX;EAQD;EAEDO,MAAMA,CAACC,OAAD,EAAiC;IACrC,MAAMZ,EAAE,GAAG,KAAKA,EAAhB;IAEA,MAAMa,SAAS,GAAG,CAAC,KAAD,EAAQ,KAAR,EAAe,KAAf,EAAsB,KAAtB,CAAlB;IACAA,SAAS,CAACD,OAAO,CAACE,OAAT,CAAT,GAA6B,IAA7B;IAEA,OAAOnB,cAAc,CACnBK,EADmB,EAEnB;MACEe,UAAU,EAAE,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,CADd;MAEEC,KAAK,EAAE,IAFT;MAGEC,SAAS,EAAE,MAHb;MAIEC,aAAa,OAJf;MAKEL,SALF;MAMEM,SAAS,EAAE;IANb,CAFmB,EAUnB,MAAM,MAAMR,MAAN,CAAa;MAAC,GAAGC,OAAJ;MAAaQ,MAAM,EAAE,KAAKZ,GAA1B;MAA+Ba,IAAI,EAAE;IAArC,CAAb,CAVa,CAArB;EAYD;EAEDC,eAAeA,CAACC,KAAD,EAAQ;IACrB,OAAOA,KAAK,CAACtB,KAAN,CAAYuB,SAAZ,CAAsBC,QAAtB,CAA+B,MAA/B,CAAP;EACD;EAEDC,MAAMA,CAAA,EAAG;IACP,KAAKlB,GAAL,CAASkB,MAAT;IACA,KAAKtB,OAAL,CAAasB,MAAb;EACD;AAzD8C","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}