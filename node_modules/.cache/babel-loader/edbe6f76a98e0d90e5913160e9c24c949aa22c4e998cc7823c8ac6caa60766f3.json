{"ast":null,"code":"import { withParameters } from '@luma.gl/core';\nimport { _LayersPass as LayersPass } from '@deck.gl/core';\nexport class TerrainPass extends LayersPass {\n  getRenderableLayers(viewport, opts) {\n    const {\n      layers\n    } = opts;\n    const result = [];\n    const drawParamsByIndex = this._getDrawLayerParams(viewport, opts, true);\n    for (let i = 0; i < layers.length; i++) {\n      const layer = layers[i];\n      if (!layer.isComposite && drawParamsByIndex[i].shouldDrawLayer) {\n        result.push(layer);\n      }\n    }\n    return result;\n  }\n  renderHeightMap(heightMap, opts) {\n    const target = heightMap.getRenderFramebuffer();\n    const viewport = heightMap.renderViewport;\n    if (!target || !viewport) {\n      return;\n    }\n    target.resize(viewport);\n    withParameters(this.gl, {\n      clearColor: [0, 0, 0, 0],\n      blend: true,\n      blendFunc: [1, 1],\n      blendEquation: 32776,\n      depthTest: false\n    }, () => this.render({\n      ...opts,\n      target,\n      pass: 'terrain-height-map',\n      layers: opts.layers,\n      viewports: [viewport],\n      effects: []\n    }));\n  }\n  renderTerrainCover(terrainCover, opts) {\n    const target = terrainCover.getRenderFramebuffer();\n    const viewport = terrainCover.renderViewport;\n    if (!target || !viewport) {\n      return;\n    }\n    const layers = terrainCover.filterLayers(opts.layers);\n    target.resize(viewport);\n    withParameters(this.gl, {\n      clearColor: [0, 0, 0, 0],\n      depthTest: false\n    }, () => this.render({\n      ...opts,\n      target,\n      pass: \"terrain-cover-\".concat(terrainCover.id),\n      layers,\n      effects: [],\n      viewports: [viewport]\n    }));\n  }\n}","map":{"version":3,"names":["withParameters","_LayersPass","LayersPass","TerrainPass","getRenderableLayers","viewport","opts","layers","result","drawParamsByIndex","_getDrawLayerParams","i","length","layer","isComposite","shouldDrawLayer","push","renderHeightMap","heightMap","target","getRenderFramebuffer","renderViewport","resize","gl","clearColor","blend","blendFunc","blendEquation","depthTest","render","pass","viewports","effects","renderTerrainCover","terrainCover","filterLayers","concat","id"],"sources":["/Users/jae/Downloads/dispatch_vehicles/dispatch_vehicles/simulation_vis/node_modules/@deck.gl/extensions/src/terrain/terrain-pass.ts"],"sourcesContent":["import {withParameters} from '@luma.gl/core';\nimport {Layer, Viewport, _LayersPass as LayersPass, LayersPassRenderOptions} from '@deck.gl/core';\nimport type {HeightMapBuilder} from './height-map-builder';\nimport type {TerrainCover} from './terrain-cover';\n\nimport GL from '@luma.gl/constants';\n\nexport type TerrainPassRenderOptions = LayersPassRenderOptions;\n\n/** Renders textures used by the TerrainEffect render pass */\nexport class TerrainPass extends LayersPass {\n  getRenderableLayers(viewport: Viewport, opts: TerrainPassRenderOptions): Layer[] {\n    const {layers} = opts;\n    const result: Layer[] = [];\n    const drawParamsByIndex = this._getDrawLayerParams(viewport, opts, true);\n    for (let i = 0; i < layers.length; i++) {\n      const layer = layers[i];\n      if (!layer.isComposite && drawParamsByIndex[i].shouldDrawLayer) {\n        result.push(layer);\n      }\n    }\n\n    return result;\n  }\n\n  renderHeightMap(heightMap: HeightMapBuilder, opts: Partial<TerrainPassRenderOptions>) {\n    // console.log('Updating height map')\n    const target = heightMap.getRenderFramebuffer();\n    const viewport = heightMap.renderViewport;\n\n    if (!target || !viewport) {\n      return;\n    }\n\n    target.resize(viewport);\n\n    withParameters(\n      this.gl,\n      {\n        clearColor: [0, 0, 0, 0],\n        blend: true,\n        blendFunc: [GL.ONE, GL.ONE],\n        blendEquation: GL.MAX,\n        depthTest: false\n      },\n      () =>\n        this.render({\n          ...opts,\n          target,\n          pass: 'terrain-height-map',\n          layers: opts.layers!,\n          viewports: [viewport],\n          effects: []\n        })\n    );\n  }\n\n  renderTerrainCover(terrainCover: TerrainCover, opts: Partial<TerrainPassRenderOptions>) {\n    // console.log('Updating terrain cover ' + terrainCover.id)\n    const target = terrainCover.getRenderFramebuffer();\n    const viewport = terrainCover.renderViewport;\n\n    if (!target || !viewport) {\n      return;\n    }\n\n    const layers = terrainCover.filterLayers(opts.layers!);\n    target.resize(viewport);\n\n    withParameters(\n      this.gl,\n      {\n        clearColor: [0, 0, 0, 0],\n        depthTest: false\n      },\n      () =>\n        this.render({\n          ...opts,\n          target,\n          pass: `terrain-cover-${terrainCover.id}`,\n          layers,\n          effects: [],\n          viewports: [viewport]\n        })\n    );\n  }\n}\n"],"mappings":"AAAA,SAAQA,cAAR,QAA6B,eAA7B;AACA,SAAyBC,WAAW,IAAIC,UAAxC,QAAkF,eAAlF;AASA,OAAO,MAAMC,WAAN,SAA0BD,UAA1B,CAAqC;EAC1CE,mBAAmBA,CAACC,QAAD,EAAqBC,IAArB,EAA8D;IAC/E,MAAM;MAACC;IAAD,IAAWD,IAAjB;IACA,MAAME,MAAe,GAAG,EAAxB;IACA,MAAMC,iBAAiB,GAAG,KAAKC,mBAAL,CAAyBL,QAAzB,EAAmCC,IAAnC,EAAyC,IAAzC,CAA1B;IACA,KAAK,IAAIK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,MAAM,CAACK,MAA3B,EAAmCD,CAAC,EAApC,EAAwC;MACtC,MAAME,KAAK,GAAGN,MAAM,CAACI,CAAD,CAApB;MACA,IAAI,CAACE,KAAK,CAACC,WAAP,IAAsBL,iBAAiB,CAACE,CAAD,CAAjB,CAAqBI,eAA/C,EAAgE;QAC9DP,MAAM,CAACQ,IAAP,CAAYH,KAAZ;MACD;IACF;IAED,OAAOL,MAAP;EACD;EAEDS,eAAeA,CAACC,SAAD,EAA8BZ,IAA9B,EAAuE;IAEpF,MAAMa,MAAM,GAAGD,SAAS,CAACE,oBAAV,EAAf;IACA,MAAMf,QAAQ,GAAGa,SAAS,CAACG,cAA3B;IAEA,IAAI,CAACF,MAAD,IAAW,CAACd,QAAhB,EAA0B;MACxB;IACD;IAEDc,MAAM,CAACG,MAAP,CAAcjB,QAAd;IAEAL,cAAc,CACZ,KAAKuB,EADO,EAEZ;MACEC,UAAU,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CADd;MAEEC,KAAK,EAAE,IAFT;MAGEC,SAAS,EAAE,MAHb;MAIEC,aAAa,OAJf;MAKEC,SAAS,EAAE;IALb,CAFY,EASZ,MACE,KAAKC,MAAL,CAAY;MACV,GAAGvB,IADO;MAEVa,MAFU;MAGVW,IAAI,EAAE,oBAHI;MAIVvB,MAAM,EAAED,IAAI,CAACC,MAJH;MAKVwB,SAAS,EAAE,CAAC1B,QAAD,CALD;MAMV2B,OAAO,EAAE;IANC,CAAZ,CAVU,CAAd;EAmBD;EAEDC,kBAAkBA,CAACC,YAAD,EAA6B5B,IAA7B,EAAsE;IAEtF,MAAMa,MAAM,GAAGe,YAAY,CAACd,oBAAb,EAAf;IACA,MAAMf,QAAQ,GAAG6B,YAAY,CAACb,cAA9B;IAEA,IAAI,CAACF,MAAD,IAAW,CAACd,QAAhB,EAA0B;MACxB;IACD;IAED,MAAME,MAAM,GAAG2B,YAAY,CAACC,YAAb,CAA0B7B,IAAI,CAACC,MAA/B,CAAf;IACAY,MAAM,CAACG,MAAP,CAAcjB,QAAd;IAEAL,cAAc,CACZ,KAAKuB,EADO,EAEZ;MACEC,UAAU,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CADd;MAEEI,SAAS,EAAE;IAFb,CAFY,EAMZ,MACE,KAAKC,MAAL,CAAY;MACV,GAAGvB,IADO;MAEVa,MAFU;MAGVW,IAAI,mBAAAM,MAAA,CAAmBF,YAAY,CAACG,EAAhC,CAHM;MAIV9B,MAJU;MAKVyB,OAAO,EAAE,EALC;MAMVD,SAAS,EAAE,CAAC1B,QAAD;IAND,CAAZ,CAPU,CAAd;EAgBD;AA3EyC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}